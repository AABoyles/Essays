<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Ethereum Price Prediction</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
div.sourceCode {
  overflow-x: visible;
}
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="site_libs/style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Anthony A. Boyles</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">Portfolio</a>
</li>
<li>
  <a href="../essays/">Essays</a>
</li>
<li>
  <a href="../code.html">Code</a>
</li>
<li>
  <a href="../about.html">About</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../README.html">Meta</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Ethereum Price Prediction</h1>

</div>


<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">source</span>(<span class="st">&quot;infobox.R&quot;</span>)
<span class="kw">infobox</span>(<span class="kw">list</span>(
  <span class="st">&quot;Status&quot;</span> =<span class="st"> &quot;Incomplete&quot;</span>,
  <span class="st">&quot;Last Revision&quot;</span> =<span class="st"> </span><span class="kw">file.info</span>(<span class="st">&quot;EthereumPricePrediction.Rmd&quot;</span>)<span class="op">$</span>mtime,
  <span class="st">&quot;Epistemic Status&quot;</span> =<span class="st"> &quot;Highly Speculative&quot;</span>,
  <span class="st">&quot;Content Warning&quot;</span> =<span class="st"> &quot;This is not investment advice. I have no idea what I&#39;m doing.&quot;</span>
))</code></pre></div>
<div class="infobox">
<table class="infoboxtable table table-striped">
<tbody>
<tr>
<td>
<b>Status</b>
</td>
<td>Incomplete</td>
</tr>
<tr>
<td>
<b>Last Revision</b>
</td>
<td>2017-12-15 13:57:25</td>
</tr>
<tr>
<td>
<b>Epistemic Status</b>
</td>
<td>Highly Speculative</td>
</tr>
<tr>
<td>
<b>Content Warning</b>
</td>
<td>This is not investment advice. I have no idea what I'm doing.</td>
</tr>
</tbody>
<tfoot></tfoot>
</table>
</div>
<p>Cryptocurrencies have been doing rather well recently.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;tidyverse&#39;</span>)
<span class="kw">library</span>(<span class="st">&#39;anytime&#39;</span>)
<span class="kw">download.file</span>(<span class="st">&#39;https://etherscan.io/chart/etherprice?output=csv&#39;</span>, <span class="st">&#39;../data-cache/ethereum.csv&#39;</span>)
prices &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&#39;../data-cache/ethereum.csv&#39;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">transmute</span>(
    <span class="dt">ds =</span> <span class="kw">anydate</span>(<span class="st">`</span><span class="dt">UnixTimeStamp</span><span class="st">`</span>),
    <span class="dt">y =</span> Value
  )</code></pre></div>
<pre><code>## Parsed with column specification:
## cols(
##   `Date(UTC)` = col_character(),
##   UnixTimeStamp = col_integer(),
##   Value = col_double()
## )</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(prices, <span class="kw">aes</span>(<span class="dt">x =</span> ds, <span class="dt">y =</span> y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="EthereumPricePrediction_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Nice Exponential growth recently! Let’s log-scale that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(prices, <span class="kw">aes</span>(<span class="dt">x =</span> ds, <span class="dt">y =</span> y)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span><span class="kw">scale_y_log10</span>()</code></pre></div>
<pre><code>## Warning: Transformation introduced infinite values in continuous y-axis</code></pre>
<p><img src="EthereumPricePrediction_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>Cool! Now, let’s consult Facebook’s <a href="https://facebookincubator.github.io/prophet/">Prophet</a> to see if it predicts a long-term trend.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&#39;prophet&#39;</span>)
m &lt;-<span class="st"> </span><span class="kw">prophet</span>(prices)</code></pre></div>
<pre><code>## Disabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.</code></pre>
<pre><code>## Initial log joint probability = -79.2168
## Optimization terminated normally: 
##   Convergence detected: relative gradient magnitude is below tolerance</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">future &lt;-<span class="st"> </span><span class="kw">make_future_dataframe</span>(m, <span class="dt">periods =</span> <span class="dv">365</span>)
forecast &lt;-<span class="st"> </span><span class="kw">predict</span>(m, future)
<span class="kw">plot</span>(m, forecast)</code></pre></div>
<p><img src="EthereumPricePrediction_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Short answer, “yes.” However, it’s pretty obviously a lousy forecast. Prophet probably doesn’t pick up exponential trends. We might’ve been able to guess this based on the fact that <a href="https://facebookincubator.github.io/prophet/docs/quick_start.html#r-api">the R tutorial</a> uses an exponential trend and log-transforms it before modeling. Let’s do the same!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prices &lt;-<span class="st"> </span>prices <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y =</span> <span class="kw">log10</span>(y<span class="op">+</span><span class="dv">1</span>))

m &lt;-<span class="st"> </span><span class="kw">prophet</span>(prices)</code></pre></div>
<pre><code>## Disabling daily seasonality. Run prophet with daily.seasonality=TRUE to override this.</code></pre>
<pre><code>## Initial log joint probability = -7.49499
## Optimization terminated normally: 
##   Convergence detected: relative gradient magnitude is below tolerance</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">future &lt;-<span class="st"> </span><span class="kw">make_future_dataframe</span>(m, <span class="dt">periods =</span> <span class="dv">365</span>)
forecast &lt;-<span class="st"> </span><span class="kw">predict</span>(m, future)
<span class="kw">plot</span>(m, forecast)</code></pre></div>
<p><img src="EthereumPricePrediction_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>Wow, that’s much better! Based on this, the obvious long term strategy is to buy and hold (remember, that y-axis is the log base 10, so 4 really means $10,000). But is there any reason to believe we could do better?</p>
<div id="short-term-strategy-if-up-buy-else-sell" class="section level2">
<h2>Short-Term Strategy: If up, Buy, else Sell</h2>
<p>This strategy should sound like it’s a stark contrast to the conventional wisdom of “Buy low, sell High.” However, it’s slightly more nuanced than that. The general assumption is that down days will tend to follow down days, and likewise with up days. First, is this actually true?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prices <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">yesterday =</span> dplyr<span class="op">::</span><span class="kw">lag</span>(y),
    <span class="dt">dayBefore =</span> dplyr<span class="op">::</span><span class="kw">lag</span>(y, <span class="dt">n =</span> <span class="dv">2</span>)
  ) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(dayBefore)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">buy =</span> <span class="kw">ifelse</span>(yesterday <span class="op">&gt;</span><span class="st"> </span>dayBefore, <span class="dv">1</span>, <span class="op">-</span><span class="dv">1</span>))</code></pre></div>
<pre><code>## # A tibble: 871 x 5
##            ds         y yesterday dayBefore   buy
##        &lt;date&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
##  1 2015-07-31 0.0000000 0.0000000 0.0000000    -1
##  2 2015-08-01 0.0000000 0.0000000 0.0000000    -1
##  3 2015-08-02 0.0000000 0.0000000 0.0000000    -1
##  4 2015-08-03 0.0000000 0.0000000 0.0000000    -1
##  5 2015-08-04 0.0000000 0.0000000 0.0000000    -1
##  6 2015-08-05 0.0000000 0.0000000 0.0000000    -1
##  7 2015-08-06 0.6020600 0.0000000 0.0000000    -1
##  8 2015-08-07 0.3424227 0.6020600 0.0000000     1
##  9 2015-08-08 0.3424227 0.3424227 0.6020600    -1
## 10 2015-08-09 0.0000000 0.3424227 0.3424227    -1
## # ... with 861 more rows</code></pre>
</div>
<div id="short-term-strategy-trust-the-prophet" class="section level2">
<h2>Short-Term Strategy: Trust the Prophet</h2>
<p>Let’s fit the model daily, take Prophet’s advice, and see where we end up.</p>
<p>For a simple strategy to start, let’s just buy and sell in increments of $10.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># (Note: If you&#39;re replicating this anaylsis, this runs rather slowly since it has to fit ~320 Prophet models.)</span>

predictions &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">ds=</span><span class="kw">c</span>(), <span class="dt">y=</span><span class="kw">c</span>())
<span class="cf">for</span>(day <span class="cf">in</span> <span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&quot;2016-07-29&quot;</span>), <span class="kw">as.Date</span>(<span class="st">&quot;2017-06-14&quot;</span>), <span class="st">&quot;days&quot;</span>)){
  m &lt;-<span class="st"> </span>prices <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(ds <span class="op">&lt;</span><span class="st"> </span>day) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">prophet</span>()
  future &lt;-<span class="st"> </span><span class="kw">make_future_dataframe</span>(m, <span class="dt">periods =</span> <span class="dv">1</span>)
  forecast &lt;-<span class="st"> </span><span class="kw">predict</span>(m, future)
  predictions &lt;-<span class="st"> </span><span class="kw">rbind</span>(predictions, <span class="kw">data.frame</span>(<span class="dt">ds=</span><span class="kw">anydate</span>(day), <span class="dt">y=</span><span class="kw">tail</span>(forecast<span class="op">$</span>yhat, <span class="dv">1</span>)))
}</code></pre></div>
<p>OK, so when should one buy and when should one sell?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">orders &lt;-<span class="st"> </span>predictions <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prediction =</span> <span class="dv">10</span><span class="op">^</span>y<span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>y) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(prices) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">price =</span> <span class="dv">10</span><span class="op">^</span>y<span class="op">-</span><span class="dv">1</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">cbind</span>(<span class="dt">laggedPrice =</span> <span class="kw">lag</span>(.<span class="op">$</span>price)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(laggedPrice)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(
    <span class="dt">buy =</span> <span class="kw">ifelse</span>(prediction <span class="op">&gt;</span><span class="st"> </span>laggedPrice, <span class="dv">1</span>, <span class="dv">0</span>),
    <span class="dt">etherBoughtToday =</span> <span class="dv">10</span><span class="op">/</span>price <span class="op">*</span><span class="st"> </span>buy,
    <span class="dt">etherBalance =</span> <span class="kw">cumsum</span>(etherBoughtToday),
    <span class="dt">cost =</span> <span class="dv">10</span><span class="op">*</span><span class="kw">cumsum</span>(buy),
    <span class="dt">etherValue =</span> etherBalance<span class="op">*</span>price,
    <span class="dt">net =</span> etherValue <span class="op">-</span><span class="st"> </span>cost
  )</code></pre></div>
<p>We shouldn’t feel too bad about this. After all, Prophet was only <a href="https://github.com/facebookincubator/prophet/commit/e51b42b3360d39b9cfe6247799905404aeed6735">invented in February 2017</a>, so we couldn’t have written a trading bot with it back in July 2016.</p>
</div>
<div id="sizing-our-wagers" class="section level2">
<h2>Sizing our Wagers</h2>
<p>In general, the optimal wager size is given by the <a href="https://en.wikipedia.org/wiki/Kelly_criterion">Kelly Criterion</a>, which can be roughly stated as the ratio of your expected net winnings to the actual winnings if the bet resolves in your favor.</p>
</div>

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-109466857-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-109466857-1');
</script>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
